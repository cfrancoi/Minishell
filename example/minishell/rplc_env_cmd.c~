/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   rplc_env_cmd.c                                     :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: cfrancoi <cfrancoi@student.le-101.fr>      +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2020/10/14 16:09:57 by cfrancoi          #+#    #+#             */
/*   Updated: 2020/10/14 17:45:10 by cfrancoi         ###   ########lyon.fr   */
/*                                                                            */
/* ************************************************************************** */

#include "../include/minishell.h"
#include "../include/env.h"
#include "../Lib/libft.h"
#include <stdio.h>

static char		*get_end_var(char *ptr)
{
	int i;

	i = 0;

	while (ptr[i] && ptr[i] != ' ')
		++i;
	return (&ptr[i]);
}
static char		*get_new(char *ptr, char *line)
{
	char	*var;
	char	*new;
	char	*end;
	t_var	*env;
	
	printf("1/3\n");
	var = ft_strccpy(&ptr[1], ' ');
	new = ft_strccpy(line, '$');
	printf("2/3\n");
	printf("%s\n", var);
	env = get_var(g_list, var);
	var = env->content;
	printf("3/3\n");

	printf("%s %i\n", new, (int)ft_strlen(new));
	printf("%s\n", var);
	
	if(var != NULL)
		new = ft_strjoinf(new, var, 0);
	end = get_end_var(ptr);
	if (*end != '\0')
		new = ft_strjoinf(new ,end, 1);
	free(line);
	//free(var);
	return (new);
}

char			*rplc_env_cmd(char *ptr)
{
	char	*new;
	int		i;

	new = ptr;
	i = 0;
	printf("ok ici\n");
	while (ptr[i])
	{
		if (ptr[i] == '$' && ptr[i + 1] != '\0')
		{
			printf("ENTER\n");
			ptr = get_new(&ptr[i], ptr);
			//free(ptr);
			i = 0;
		}
		else
			++i;
	}
	new = ptr;
	printf("%s\n", new);
	return (new);
}
